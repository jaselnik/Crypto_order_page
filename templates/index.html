<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Async Order</title>
    <!-- Bootstrap core CSS -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
  </head>

  <body>

    <main role="main" class="container">
      <div class="jumbotron">
        <a class="btn btn-lg btn-primary create-order" role="button">Make Order &raquo;</a>
        <a class="btn btn-lg btn-danger close-order" role="button">Close Order &raquo;</a>

        {% from "_formhelpers.html" import render_add_client_field %}
        <form class="add-client-form" method="post" role="form">
          <dl>
              {% for field in form %}
                  {{ render_add_client_field(field) }}
              {% endfor %}
          </dl>
          <button type="submit" class="add-client btn btn-primary" data-dismiss="modal">Add Client</button>
        </form>

      </div>

        <div class="table-responsive-sm">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">balance</th>
                <th scope="col">order type</th>
                <th scope="col">symbol</th>
                <th scope="col">amount</th>
                <th scope="col">open</th>
                <th scope="col">side</th>
{#                <th scope="col">liquidation</th>#}
                <th scope="col">failed</th>
                <th scope="col">order_exist</th>
              </tr>
            </thead>
            <tbody class="client-table-body">
            <!--Here will be client data which is getting from socket-->
            </tbody>
          </table>
        </div>
    </main>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        $(document).ready(function() {
            var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);
            socket.on('connect', function () {
                socket.emit('my event', {data: 'I\'m connected!'});
            });

            socket.on('my response', function (msg) {
                console.log(msg);
            });
            socket.on('reload-table', function (msg) {
                console.log(msg);
                var data = msg['data'];
                var count = msg['count'];
                var clients_string = '';
                console.log(data);
                console.log(count);

                for (i = 0; i < count; i++) {
                    clients_string += '<tr>';
                    clients_string += '<th scope="row">' + i.toString() + '</th>';
                    clients_string += '<td>' + data[i]['data']["balance"].toString() + '</td>';
                    clients_string += '<td>' + data[i]['data']["order_type"] + '</td>';
                    clients_string += '<td>' + data[i]['data']["symbol"] + '</td>';
                    clients_string += '<td>' + data[i]['data']["amount"].toString() + '</td>';
                    clients_string += '<td>' + data[i]['data']["open"].toString() + '</td>';
                    clients_string += '<td>' + data[i]['data']["side"] + '</td>';
                    clients_string += '<td>' + data[i]['data']["failed"] + '</td>';
                    clients_string += '<td>' + data[i]['data']["order_exist"] + '</td>';
                    clients_string += '</tr>';
                }
                $(".client-table-body").html(clients_string);
            });
            $('.add-client').click(function (e) {
                socket.emit('add-client', {form: $('.add-client-form').serialize()});
                return false;
             });
            $('.create-order').click(function (e) {
                e.preventDefault();
                var side = 'sell';
                socket.emit('create-order', {side: side});
                return false;
            });
            $('.close-order').click(function (e) {
                e.preventDefault();
                socket.emit('close-order');
                return false;
            });
        });
    </script>
  </body>
</html>
